# This file is managed by Ansible, all changes will be lost

{% if kvm_ferm_forwarding is defined and kvm_ferm_forwarding %}
# Configure forwarding for KVM virtual machines

domain $domains table filter chain FORWARD {
{% if hostvars[inventory_hostname]["ansible_" + kvm_interface_external] is defined and
      hostvars[inventory_hostname]["ansible_" + kvm_interface_external].active %}
	# Forward external traffic between all hosts
	interface {{ kvm_interface_external }} ACCEPT;
	outerface {{ kvm_interface_external }} ACCEPT;
{% endif %}
{% if hostvars[inventory_hostname]["ansible_" + kvm_interface_internal] is defined and
      hostvars[inventory_hostname]["ansible_" + kvm_interface_internal].active %}

	# Forward internal traffic only on internal network
	interface {{ kvm_interface_internal }} outerface {{ kvm_interface_internal }} ACCEPT;
{% if hostvars[inventory_hostname]["ansible_" + kvm_interface_lan] is defined and
      hostvars[inventory_hostname]["ansible_" + kvm_interface_lan].active %}

	# Forward internal traffic to LAN network
	interface {{ kvm_interface_internal }} outerface {{ kvm_interface_lan }} ACCEPT;
	interface {{ kvm_interface_lan }} outerface {{ kvm_interface_internal }} ACCEPT;
{% endif %}
{% endif %}
}
{% else %}
# Packet forwarding for KVM virtual machines is disabled
{% endif %}

